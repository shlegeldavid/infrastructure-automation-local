version: '3.8'

services:
  # Standalone Selenium Chrome с VNC для первого логина
  selenium-chrome:
    image: selenium/standalone-chrome:latest
    container_name: selenium-chrome
    shm_size: '2gb'
    ports:
      - "4444:4444"   # Selenium WebDriver API
      - "7900:7900"   # noVNC веб-интерфейс (пароль: secret)
    environment:
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_OVERRIDE_MAX_SESSIONS=true
      - SE_VNC_NO_PASSWORD=1
    volumes:
      - chrome-profile-data:/opt/selenium/profile  # Сохранение профиля браузера

  # Python парсер DataLens
  datalens-bot:
    image: ghcr.io/shlegeldavid/datalens-bot:latest
    container_name: datalens-bot
    restart: unless-stopped
    depends_on:
      - selenium-chrome
    environment:
      - TG_BOT_TOKEN
      - TG_CHAT_ID
      - SELENIUM_HOST=http://selenium-chrome:4444/wd/hub
      - FIRST_RUN=false
    volumes:
      - ./data:/app/data
      - chrome-profile-data:/opt/selenium/profile

  provider-downs:
    image: ghcr.io/shlegeldavid/provider-downs:latest
    container_name: provider-downs
    profiles:
      - manual
    volumes:
      - ./data:/app/data
      - ./apps/provider-downs/provider-falls-ea0c76990c0c.json:/app/provider-falls-ea0c76990c0c.json:ro

volumes:
  chrome-profile-data:  # Том для сохранения логина между перезапусками
